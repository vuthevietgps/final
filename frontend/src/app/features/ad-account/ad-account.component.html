<!--
  File: features/ad-account/ad-account.component.html
  M·ª•c ƒë√≠ch: Template HTML cho qu·∫£n l√Ω T√†i Kho·∫£n Qu·∫£ng C√°o v·ªõi inline editing v√† responsive design.
-->

<div class="ad-account-manager">
  <!-- Header section -->
  <div class="header-section">
    <div class="title-area">
      <h1>üéØ Qu·∫£n L√Ω T√†i Kho·∫£n Qu·∫£ng C√°o</h1>
      <p class="subtitle">Qu·∫£n l√Ω c√°c t√†i kho·∫£n qu·∫£ng c√°o tr√™n c√°c n·ªÅn t·∫£ng kh√°c nhau</p>
    </div>
    
    <div class="header-actions">
      <button class="btn btn-primary" (click)="addNew()">
        <span class="icon">‚ûï</span>
        Th√™m T√†i Kho·∫£n
      </button>
      <button class="btn btn-secondary" (click)="refresh()">
        <span class="icon">üîÑ</span>
        L√†m M·ªõi
      </button>
    </div>
  </div>

  <!-- Statistics cards -->
  <div class="stats-section" *ngIf="stats().length > 0">
    <div class="stats-grid">
      <div class="stat-card" *ngFor="let stat of stats()">
        <div class="stat-icon">{{ getAccountTypeIcon(stat._id) }}</div>
        <div class="stat-info">
          <div class="stat-label">{{ getAccountTypeLabel(stat._id) }}</div>
          <div class="stat-value">{{ stat.count }} t√†i kho·∫£n</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and filter section -->
  <div class="search-section">
    <div class="search-row">
      <!-- Keyword search -->
      <div class="search-field">
        <input 
          type="text" 
          placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c ID t√†i kho·∫£n..."
          (input)="onSearchKeyword($any($event.target).value)"
          class="search-input">
      </div>

      <!-- Account type filter -->
      <div class="filter-field">
        <select (change)="onFilterAccountType($any($event.target).value)" class="filter-select">
          <option value="">T·∫•t c·∫£ lo·∫°i t√†i kho·∫£n</option>
          <option *ngFor="let type of accountTypeOptions" [value]="type.value">
            {{ type.icon }} {{ type.label }}
          </option>
        </select>
      </div>

      <!-- Status filter -->
      <div class="filter-field">
        <select (change)="onFilterStatus($any($event.target).value)" class="filter-select">
          <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
          <option value="inactive">Ng·ª´ng ho·∫°t ƒë·ªông</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Add new form -->
  <!-- Removed form section - using inline editing instead -->

  <!-- Loading state -->
  <div class="loading-section" *ngIf="isLoading()">
    <div class="loading-spinner">üîÑ</div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Error state -->
  <div class="error-section" *ngIf="error()">
    <div class="error-message">
      <span class="error-icon">‚ö†Ô∏è</span>
      {{ error() }}
    </div>
    <button class="btn btn-primary" (click)="refresh()">Th·ª≠ l·∫°i</button>
  </div>

  <!-- Data table -->
  <div class="table-section" *ngIf="!isLoading() && !error() && adAccounts().length > 0">
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th class="col-icon">Lo·∫°i</th>
            <th class="col-name">T√™n T√†i Kho·∫£n</th>
            <th class="col-account-id">ID T√†i Kho·∫£n</th>
            <th class="col-description">M√¥ T·∫£</th>
            <th class="col-status">Tr·∫°ng Th√°i</th>
            <th class="col-notes">Ghi Ch√∫</th>
            <th class="col-dates">Ng√†y T·∫°o</th>
            <th class="col-actions">Thao T√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let account of adAccounts(); trackBy: trackById" 
              class="data-row" 
              [class.editing]="editingAccountId() === account._id"
              [class.new-account]="account._id.startsWith('temp_')">
            
            <!-- Account type icon with select for new accounts -->
            <td class="col-icon">
              <select 
                *ngIf="account._id.startsWith('temp_')" 
                [value]="account.accountType"
                (change)="updateField(account, 'accountType', $any($event.target).value)"
                class="type-select">
                <option *ngFor="let type of accountTypeOptions" [value]="type.value">
                  {{ type.icon }} {{ type.label }}
                </option>
              </select>
              <span *ngIf="!account._id.startsWith('temp_')" class="account-type-icon">
                {{ getAccountTypeIcon(account.accountType) }}
              </span>
            </td>

            <!-- Name (editable) -->
            <td class="col-name">
              <input 
                type="text" 
                [value]="account.name"
                (blur)="updateField(account, 'name', $any($event.target).value)"
                (keyup.enter)="updateField(account, 'name', $any($event.target).value)"
                [placeholder]="account._id.startsWith('temp_') ? 'Nh·∫≠p t√™n t√†i kho·∫£n...' : ''"
                class="inline-input font-medium"
                [class.required]="account._id.startsWith('temp_') && !account.name">
            </td>

            <!-- Account ID (editable) -->
            <td class="col-account-id">
              <input 
                type="text" 
                [value]="account.accountId"
                (blur)="updateField(account, 'accountId', $any($event.target).value)"
                (keyup.enter)="updateField(account, 'accountId', $any($event.target).value)"
                [placeholder]="account._id.startsWith('temp_') ? 'Nh·∫≠p ID t√†i kho·∫£n...' : ''"
                class="inline-input code-text"
                [class.required]="account._id.startsWith('temp_') && !account.accountId">
            </td>

            <!-- Description (editable) -->
            <td class="col-description">
              <input 
                type="text" 
                [value]="account.description || ''"
                (blur)="updateField(account, 'description', $any($event.target).value)"
                (keyup.enter)="updateField(account, 'description', $any($event.target).value)"
                placeholder="Th√™m m√¥ t·∫£..."
                class="inline-input">
            </td>

            <!-- Status (editable) -->
            <td class="col-status">
              <label class="status-toggle">
                <input 
                  type="checkbox" 
                  [checked]="account.isActive"
                  (change)="updateField(account, 'isActive', $any($event.target).checked)"
                  class="status-checkbox">
                <span class="status-label" [class.active]="account.isActive">
                  {{ account.isActive ? '‚úÖ Ho·∫°t ƒë·ªông' : '‚ùå Ng·ª´ng' }}
                </span>
              </label>
            </td>

            <!-- Notes (editable) -->
            <td class="col-notes">
              <input 
                type="text" 
                [value]="account.notes || ''"
                (blur)="updateField(account, 'notes', $any($event.target).value)"
                (keyup.enter)="updateField(account, 'notes', $any($event.target).value)"
                placeholder="Th√™m ghi ch√∫..."
                class="inline-input">
            </td>

            <!-- Created date -->
            <td class="col-dates">
              <div class="date-info" *ngIf="!account._id.startsWith('temp_')">
                <div class="date-primary">{{ account.createdAt | date:'dd/MM/yyyy' }}</div>
                <div class="date-secondary">{{ account.createdAt | date:'HH:mm' }}</div>
              </div>
              <div class="new-label" *ngIf="account._id.startsWith('temp_')">
                <span class="new-badge">M·ªõi</span>
              </div>
            </td>

            <!-- Actions -->
            <td class="col-actions">
              <div class="action-buttons">
                <!-- Save/Cancel for new accounts -->
                <div *ngIf="account._id.startsWith('temp_')" class="new-account-actions">
                  <button 
                    class="btn-action btn-save" 
                    (click)="saveNewAccount(account)"
                    [disabled]="!account.name || !account.accountId"
                    title="L∆∞u t√†i kho·∫£n">
                    üíæ
                  </button>
                  <button 
                    class="btn-action btn-cancel" 
                    (click)="cancelAdd(account._id)"
                    title="H·ªßy">
                    ‚úñ
                  </button>
                </div>
                
                <!-- Delete for existing accounts -->
                <button 
                  *ngIf="!account._id.startsWith('temp_')"
                  class="btn-action btn-danger" 
                  (click)="deleteAccount(account)"
                  title="X√≥a t√†i kho·∫£n">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Empty state -->
  <div class="empty-section" *ngIf="!isLoading() && !error() && adAccounts().length === 0">
    <div class="empty-content">
      <div class="empty-icon">üì≠</div>
      <h3>Ch∆∞a c√≥ t√†i kho·∫£n qu·∫£ng c√°o n√†o</h3>
      <p>B·∫Øt ƒë·∫ßu b·∫±ng c√°ch th√™m t√†i kho·∫£n qu·∫£ng c√°o ƒë·∫ßu ti√™n c·ªßa b·∫°n</p>
      <button class="btn btn-primary" (click)="addNew()">
        <span class="icon">‚ûï</span>
        Th√™m T√†i Kho·∫£n ƒê·∫ßu Ti√™n
      </button>
    </div>
  </div>
</div>
