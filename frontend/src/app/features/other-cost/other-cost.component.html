<div class="other-cost-page">
  <div class="toolbar">
    <div class="title">
      <span class="icon">üí∏</span>
      <h2>Chi Ph√≠ Kh√°c</h2>
    </div>
    <div class="filters">
      <label>
        T·ª´ ng√†y
        <input type="date" [ngModel]="fromDate()" (ngModelChange)="fromDate.set($event)" />
      </label>
      <label>
        ƒê·∫øn ng√†y
        <input type="date" [ngModel]="toDate()" (ngModelChange)="toDate.set($event)" />
      </label>
      <button class="btn" (click)="loadData()">L·ªçc</button>
      <button class="btn btn-secondary" (click)="fromDate.set(''); toDate.set(''); loadData()">Reset</button>
    </div>
    <div class="actions">
      <button class="btn btn-primary" (click)="openCreate()">‚ûï Th√™m</button>
  <a class="btn" [href]="getExportUrl()" target="_blank" rel="noopener">‚¨áÔ∏è Xu·∫•t CSV</a>
    </div>
  </div>

  <div class="summary" *ngIf="summary()">
    <div class="card">
      <div class="label">T·ªïng chi ph√≠</div>
      <div class="value">{{ summary()!.totalAmount | number:'1.0-0' }} ƒë</div>
    </div>
    <div class="card">
      <div class="label">S·ªë giao d·ªãch</div>
      <div class="value">{{ summary()!.count }}</div>
    </div>
  </div>

  <div class="table-wrapper" *ngIf="!loading(); else loadingTpl">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ng√†y</th>
          <th class="right">Chi ph√≠</th>
          <th>Ghi ch√∫</th>
          <th>Link ch·ª©ng t·ª´</th>
          <th class="center">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of costs()">
          <td>{{ c.date | date:'yyyy-MM-dd' }}</td>
          <td class="right">{{ c.amount | number:'1.0-0' }} ƒë</td>
          <td>{{ c.notes }}</td>
          <td>
            <a *ngIf="c.documentLink" [href]="c.documentLink" target="_blank" rel="noopener">M·ªü link</a>
          </td>
          <td class="center">
            <button class="btn btn-sm" (click)="openEdit(c)">S·ª≠a</button>
            <button class="btn btn-sm btn-danger" (click)="remove(c._id!)">X√≥a</button>
          </td>
        </tr>
        <tr *ngIf="costs().length === 0">
          <td colspan="5" class="center muted">Ch∆∞a c√≥ d·ªØ li·ªáu</td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">ƒêang t·∫£i...</div>
  </ng-template>

  <!-- Modal -->
  <div class="modal-backdrop" *ngIf="showModal()" (click)="closeModal()"></div>
  <div class="modal" *ngIf="showModal()">
    <div class="modal-header">
      <h3>{{ editingId ? 'Ch·ªânh s·ª≠a' : 'Th√™m m·ªõi' }} Chi ph√≠</h3>
      <button class="btn-close" (click)="closeModal()">‚úï</button>
    </div>
    <form [formGroup]="form" (ngSubmit)="save()" class="modal-body">
      <div class="grid">
        <label>
          Ng√†y
          <input type="date" formControlName="date" />
        </label>
        <label>
          Chi ph√≠ (ƒë)
          <input type="number" formControlName="amount" min="0" step="1000" />
        </label>
        <label class="col-span-2">
          Ghi ch√∫
          <input type="text" formControlName="notes" placeholder="Ghi ch√∫ (kh√¥ng b·∫Øt bu·ªôc)" />
        </label>
        <label class="col-span-2">
          Link ch·ª©ng t·ª´
          <input type="text" formControlName="documentLink" placeholder="D√°n link t√†i li·ªáu (t√πy ch·ªçn)" />
        </label>
      </div>
      <div class="modal-actions">
        <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading()">L∆∞u</button>
        <button type="button" class="btn" (click)="closeModal()">H·ªßy</button>
      </div>
    </form>
  </div>
</div>
